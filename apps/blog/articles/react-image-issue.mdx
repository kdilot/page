import { Tags, Title } from '@page/blog/ui'

<Title title="React 업로드 된 이미지 사용시 발생하는 이슈" year={2020} />

<Tags data={['React', 'CRA', 'Image']} />

> 이미지 업로드 오픈소스를 사용하니 모바일에서 이미지 업로드시 회전이 발생
>
> 이미지 로드에 최적화가 필요

## 시도한 방법들

- 이미지 Lazyload
- 이미지 리사이징
- 이미지 회전

## 결과

### 이미지 Lazyload

- `react-lazy-load-image-component` 패키지를 통해 `cra` 에 바로 적용이 가능함
- 이미지 `용량` 자체가 최적화된 것이 아니기 때문에 `용량이 큰` 이미지는 로드가 `오래`걸림

### 이미지 리사이징

- 시도해본 대다수의 패키지들은 서버사이드에서 사용이 가능했음
- 이미지 업로드시에 `서버에서 가공` 하기엔 프론트 페이지에서 저장하는 시간이 더 오래 걸릴 것으로 판단하여 `프론트에서 가공`하는 방법을 시도
  - `프론트에서` 이미지 회전시 서버에서 이미지를 리사이징 할 때 `디바이스`에 따라 회전이 추가발생
- 이미지를 읽어서 퀄리티 또는 사이즈를 줄이는 방법 적용
  - `png` 보다는 `jpg` 에서 큰 리사이징 효과를 볼 수 있음
  - `gif` 는 별도로 처리해주는 방법을 사용해야함( 적용하지 않음 )
  - 간혹 퀄리티 조정 후 이미지 `색감`이 변질되는 케이스가 있었음

### 이미지 회전

- 안드로이드, iOS 기종에 따라 이미지 업로드시 회전돼서 저장되는 케이스가 존재
  - 주로 `안드로이드`에서 발생했음
  - 안드로이드 기종에 따라서 적용이 되고 안되는 케이스가 다수 발견됨
  - 정확한 기종에 대한 자료가 없어서 완벽하게 분리하기엔 어려움
- 대부분 괜찮은 패키지들은 서버사이드에서 사용이 가능했음
- 구글링을 통해 JS로 구성된 함수를 사용
  - 이미지 `orientaion` 값을 읽어 회전이 된 이미지를 돌려줌
- 이미지 회전을 시키지 않고 읽어올 때 돌아간 이미지를 회전처리
  - `react-exif-orientation-img` 패키지를 사용
  - 패키지 활용 시 `서버에서` 리사이징 된 이미지가 `디바이스`에 따라 추가 회전되는 경우가 생김

## 코멘트

- 최종적으로 적용한 방법은 `서버에 저장`시 서버에서 `원본`, `고화질`, `중화질`, `저화질`로 리사이징
  - `프론트` 페이지에서 화면 `width`에 맞는 이미지를 호출
  - `Lazyload` 패키지 적용
  - `디바이스`에 따른 모바일 업로드 이슈는 과제로 남음
- 서버로 이미지 업로드시 `S3`에 올렸으나 `3MB` 초과시 오류가 발생했는데 프론트 작업을 담당하다보니 정확한 원인을 파악하지 못함
- `Medium` 같은 곳에선 이미지 로드시에 `blur 처리된 저화질`을 다운받아 빨리 보여주고, `고화질 이미지가 다운로드 완료`됐을 때 교체해주는 방식을 사용하는 것으로 예상했은데 같은 방법으로 시도 해보면 좋을 것 같음
- `서버에서` 이미지 리사이징시 `orientation` 까지 체크해서 저장이 가능하다면, 가장 좋은 해결법이 될 것 같음
